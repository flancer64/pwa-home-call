# Итерационный отчёт: выравнивание web-документации под сценарий приглашения

Цель: привести `ctx/rules/web/` в соответствие с продуктовой моделью приглашения через ссылку, где «поделиться ссылкой» — действие инициатора (toolbar), а экран `invite` — только для получателя приглашения.

## Изменённые документы

- ctx/rules/web/app.md — добавлено состояние `invite`, маршруты `enter → invite → lobby`, поведение при запуске и раздел «Основной и альтернативный потоки»; добавлены связи с `features/invite.md` и `ui/screens/invite.md`.
- ctx/rules/web/contours/ui.md — уточнены состояния (`invite`), добавлено событие `ui:action:share-link`, зафиксировано: `invite` только для получателя; инициатор остаётся в `lobby`/`call`/`end`.
- ctx/rules/web/contours/core.md — добавлены маршруты `enter → invite → lobby`, обработка `ui:action:share-link`, коллбэки `onInviteConfirmed`; сценарий приглашения — расширение основного потока.
- ctx/rules/web/ui/screens/invite.md — экран используется только получателем; убраны детали Web Share API; отражены чтение URL, read-only room, ввод имени, подтверждение join, уведомления; связи обновлены на `features/invite.md`.
- ctx/rules/web/ui/toolbar.md — «Поделиться ссылкой» доступно инициатору в `lobby`/`call`/`end`; генерирует `ui:action:share-link`; `invite` не инициирует это действие; добавлена связь с `features/invite.md`.
- ctx/rules/web/ui/screens.md — поток: `enter → invite → lobby → call → end → lobby`; добавлен раздел «Роль сценария приглашения»; ссылки обновлены на `features/invite.md`.
- ctx/rules/web/infra/storage.md — при наличии URL-параметров `room`/`name` выполняется синхронизация с локальным хранилищем; значения отображаются на `invite`; ссылка на сценарий `product/scenarios/local-storage.md` исправлена.

## Соответствие 7 критериям ADSM

1. Декларативность — документы описывают цели и поведение (что/зачем), без реализации.
2. Полнота — покрыты основной поток и альтернативный (приглашение), роли инициатора/получателя разведены.
3. Непротиворечивость — маршруты и события согласованы между `app`, `core`, `ui`, `screens`, `toolbar`, `storage`.
4. Связность — добавлены/уточнены связи с `ctx/product/features/invite.md` и `ctx/product/scenarios/share-and-join.md`.
5. Плотность — убраны повторы и лишние детали (Web Share API исключён из `invite`).
6. Компактность — структура разделов и формулировки выровнены, ключевые потоки вынесены явно.
7. Неизбыточность — функции не дублируются: `share` живёт в toolbar; `invite` отвечает только за подтверждение/вход.

## Итог

Документация `rules/web` согласована с продуктовой моделью: основной путь — без приглашения; приглашение — дополнительная ветка. Разграничены роли инициатора и получателя, ссылки и события унифицированы.

