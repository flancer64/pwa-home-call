# Базовая структура интерфейса

Этот документ описывает экранный контур браузерного приложения HomeCall, определённого в `app.md`.

## Назначение

Документ определяет минимальный набор пользовательских экранов **HomeCall PWA**, достаточный для установления видеосвязи 1-на-1.  
Цель — зафиксировать логику взаимодействия пользователя с системой и последовательность состояний интерфейса без визуальной детализации.

Состояния и экраны соответствуют сценариям `enter`, `lobby`, `call`, `end`, описанным в `app.md`.

## Границы и интерфейсы

Экранный контур ограничен тем, что описано в `app.md`: документ не содержит описаний конкретных компонентов или реализаций, только последовательность состояний и переходов.

---

## Основные экраны

1. **Вход** — ввод кодового слова комнаты и первичное взаимодействие пользователя с приложением.
2. **Лобби** — отображение подключённых участников и выбор собеседника.
3. **Звонок** — активная видеосессия (WebRTC).
4. **Завершение** — экран после разрыва или окончания вызова, возврат к лобби.

---

## Поведение при первом подключении и разрешениях

Первое взаимодействие пользователя с приложением требует согласия на использование камеры и микрофона. Для упрощения процесса и снижения отказов интерфейс должен обеспечивать понятный и безопасный UX-поток.

### Экран «Вход»

- Сразу отображается интерфейс с пояснением, **зачем нужны камера и микрофон**.
- Разрешения на использование устройств запрашиваются **только по действию пользователя** — через кнопку «Подготовить камеру» или «Проверить устройства».
- При отказе в доступе отображаются инструкции:
  - как повторно проверить устройства и запустить `prepareMedia()` ещё раз;
  - уведомление, что `HomeCall_Web_Media_Manager` автоматически определяет блокировку устройств и предложит повторную проверку, когда они станут доступными.
- Для iOS и Android могут отображаться короткие пошаговые подсказки.

### Экран «Лобби»

- Отображается независимо от того, даны ли разрешения.
- Если разрешения отсутствуют, в интерфейсе появляется предупреждение и кнопка «Разрешить доступ» для повторного вызова `prepareMedia()`.
- При успешном получении разрешений отображается уведомление о готовности устройств.

### Экран «Звонок»

- Поддерживает работу в режиме:
  - аудио + видео (полный доступ),
  - только аудио (нет камеры),
  - только видео (нет микрофона),
  - без медиа (только сигналинг).
- При отсутствии устройств выводится информационный блок «Видео недоступно, но разговор возможен».
- Кнопка «Повторить попытку» инициирует повторную проверку и запрос разрешений.
- При возврате устройств (`devicechange`) появляется уведомление «Камера снова работает».

---

### Раскладка видеопотоков (экран «Звонок»)

- Видео собеседника занимает основной фон, центрируется и масштабируется без искажений (fit по большей стороне окна).
- Видео пользователя отображается уменьшенным (20–25 % ширины экрана) поверх основного потока.
- Миниатюра располагается в углу (по умолчанию — правый нижний), с отступами и скруглёнными краями.
- При смене ориентации сохраняется пропорция сторон и положение миниатюры.
- На десктопе принцип тот же: собеседник в центре, пользователь — наложенная миниатюра.

---

## Принципы

- Приложение — одноэкранное (SPA), экраны — состояния.
- Навигация линейная: **Вход → Лобби → Звонок → Завершение → Лобби**.
- Перечень экранов и их последовательность соответствуют состояниям приложения, описанным в `app.md`.
- Интерфейс адаптирован под мобильные устройства.
- Кнопки действий и уведомления о разрешениях должны быть крупными и контрастными.
- Все переходы управляются логикой приложения без перезагрузки страницы.
- При отсутствии разрешений приложение сохраняет функциональность и информирует пользователя о текущем состоянии.

---

## Связи

- `ctx/rules/web/app.md` — сценарии состояний `enter`, `lobby`, `call`, `end`.
- `ctx/rules/web/contours/ui.md` — экранная логика и реакции на `ui:action`.

## Итог

Скелет интерфейса HomeCall включает четыре состояния, расширенные требованиями к UX первого входа и управлению разрешениями.  
Документ фиксирует структуру экранов и принципы поведения интерфейса, обеспечивающие предсказуемое и понятное взаимодействие пользователя с системой.
См. также `ctx/rules/web/app.md` — обзорный документ браузерного приложения HomeCall.
