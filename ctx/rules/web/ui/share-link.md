# Share Link Mechanism

**Path:** ./ctx/rules/web/ui/share-link.md

## Purpose

Документ описывает технику создания и распространения одноразовой ссылки, которая делает экран `invite` предельно минималистичным: на нём лишь заголовок, ссылка и две большие кнопки действия.

## Шаблон ссылки

- Всегда `https://<домен>/?session=<uuid>`, без лишних параметров.
- `sessionId` создаётся при тапе **«Связать»** и хранится в контексте `NetSession`.
- Получатель сразу получает `sessionId` через URL и не вводит никаких данных.

## Generating and sharing

1. `home` вызывает `sessionManager.createSessionId()` → `sessionManager.buildInviteUrl()` → `share-link.generateShareLink()`.
2. `share-link` пытается уйти в Web Share API (`navigator.share`). При успехе появляется `toast.success('Ссылка отправлена.').`
3. Если `navigator.share` отсутствует или отменён пользователем, `share-link` падает обратно на Clipboard API и показывает `toast.success('Ссылка скопирована в буфер обмена.')`.
4. Если clipboard тоже недоступен, назначается `toast.warn('Не удалось скопировать автоматически. Выделите ссылку вручную.')`.
5. Сформированная ссылка передаётся в `invite` и отображается пользователю; никакие дополнительные инструкции не появляются — только заголовок, текст ссылки и кнопки.

## Invite screen responsibilities

- Отвечает за отображение ссылки (`invite-link`) и двух кнопок: основной (`Поделиться` или `Скопировать ссылку`) и CTA **«Связать»**.
- Библиотека `invite-service` принимает `canShare`, `onShareLink` и `onCopyLink`, выбирает нужную иконку и текст и запускает `share-link`.
- Технические детали шаринга, включающие `navigator.share`, Clipboard API и очередность тостов, описаны здесь; `invite.md` говорит только о визуальной схеме.

## Статусы

- Успех шаринга или копирования отображается через `toast.success`.
- Ошибки шаринга или записи в буфер превращаются в `toast.warn` (без дополнительных экранов).
- Копирование ссылок после Share API выполняется незримо, чтобы экран оставался чистым.

## Ссылки

- `./invite.md` — описание визуальной структуры зоны ссылки и кнопок.
- `./notifications.md` — описание тостов для подтверждений и ошибок.
