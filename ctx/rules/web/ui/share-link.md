# Share Link Mechanism

**Path:** ./ctx/rules/web/ui/share-link.md

## Purpose
Документ описывает, как ДомоЗвон превращает один тап в общее приглашение и сохраняет экран `invite` минималистичным, даже если Web Share API недоступен.

## Шаблон ссылки
- Ссылка всегда имеет вид `https://<домен>/?session=<uuid>` без дополнительных параметров.  
- UUID создаётся в момент нажатия **«Позвонить»** и используется `sessionId`-контекстом `Core`.
- Ссылка не требует ввода имени — получатель получает `sessionId` напрямую из URL.

## Invite screen flow

1. После генерации `sessionId` `HomeCall_Web_Core_App` вызывает `share-link.generateShareLink(sessionId)` и показывает `invite` с заголовком «Ссылка готова. Отправьте её собеседнику.».
2. Основная зона содержит текстовую ссылку `https://<…>/?session=<uuid>` (выделяемую, чтобы пользователь мог скопировать вручную), две кнопки (**«Скопировать ссылку»**, **«Поделиться»**) и кнопку **«Начать звонок»**, которая запускает `call`.
3. Если `navigator.share` доступен, **«Поделиться»** открывает нативный шаринг, иначе кнопка скрывается и пользователь пользуется буфером.
4. `Core` обновляет `toast`: `toast.success('Ссылка скопирована в буфер обмена.')` или `toast.warn('Не удалось скопировать — выделите ссылку вручную.')`.

## Recipient flow

- При открытии ссылки Domozvon читает параметр `session` и передаёт его Core.  
- Нет формы, пользователю не нужно вводить данные: `Core` сразу включает `Media.prepare()`, `Net.startSignal(sessionId)` и `Rtc.startIncomingSession(sessionId)`; экран `call` появляется после готовности устройств.  
- Если приглашённый возвращается на `home`, предыдущий `sessionId` автоматически очищается — новый сеанс начнётся только после повторного нажатия **«Позвонить»**.

## Status feedback

- Ошибки шаринга (отказ в доступе к clipboard, отмена Share API) показываются коротким toast-сообщением (`«Нажмите и удерживайте ссылку, чтобы скопировать её вручную.»`), сам экран остаётся чистым.  
- После удачного копирования/поделения `toast.success('Ссылка готова.')`.  
- `invite` не содержит лишних предупреждений — пользователю предлагаются только одноразовая ссылка и крупные кнопки.
