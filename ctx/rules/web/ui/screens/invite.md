# Invite Screen

**Путь**: ./rules/web/ui/screens/invite.md

## Назначение

Экран `invite` назначен исключительно инициатору приглашения. Он формирует отдельную ветку сценария — инициатор открывает его вручную через меню/toolbar (`ui:action:share-link`), собирает имя собеседника и комнату назначения и получает ссылку, которую можно отправить другим участникам. Экран не подключает к сигнализации и не предназначен для получателей — они всегда начинают с `enter`.

## Поток

1. Пользователь вызывает пункт «Поделиться ссылкой» в меню/toolbar; Core обрабатывает `ui:action:share-link`, фиксирует текущие `room`/`name` и вызывает `HomeCall_Web_Ui_Screen_Invite`.
2. `invite` отображает форму с полями:
   - «Имя приглашённого» — редактируемое текстовое поле с возможным предзаполнением из локального хранилища;
   - «Комната назначения» — редактируемое текстовое поле, позволяющее переопределить комнату, в которую будет вести ссылка.
3. При подтверждении (`invite:confirm`) экран валидирует ввод, формирует URL с параметрами `room` и `name`, запускает Web Share API (`navigator.share`) и/или fallback-копирование (`navigator.clipboard.writeText`), а затем сообщает об успешной отправке через `HomeCall_Web_Ui_Toast`.
4. После отправки (`invite:confirm`) или отмены (`invite:cancel`) `invite` закрывается, а инициатор возвращается к предыдущему экрану и продолжает основной поток без изменений текущего подключения.

## События

- `invite:confirm` — появляется при нажатии кнопки подтверждения; экран передаёт Core окончательные `name`/`room`, Core генерирует ссылку, выполняет `navigator.share`/clipboard и запускает уведомление `HomeCall_Web_Ui_Toast`. Экран закрывается и возвращается к предыдущему состоянию.
- `invite:cancel` — экран закрывается без генерации ссылки, Core возвращает пользователя туда же, где была инициирована операция.

## Интеграции

- `HomeCall_Web_Ui_Toast` — показывает ошибки валидации, результат попыток `navigator.share` и информацию о том, что ссылка скопирована в буфер.
- `HomeCall_Web_Infra_Storage` — может хранить последний ввод инициатора (имя и комнату) для удобного повторного использования на следующем вызове `invite`.
- `HomeCall_Web_Core_App` — открывает `invite` по событию `ui:action:share-link`, принимает `invite:confirm`/`invite:cancel`, управляет возвратом к предыдущему экрану и обеспечивает, чтобы основной поток `enter → lobby → call → end → lobby` не прерывался.

## Связи

- `ctx/rules/web/app.md` — вспомогательный экран, вызывающийся вручную и не входящий в основной UX-поток.
- `ctx/rules/web/ui/toolbar.md` — пункт меню «Поделиться ссылкой» и событие `ui:action:share-link`.
- `ctx/product/features/invite.md` — бизнес-описание функции приглашения и роли Web Share API.
