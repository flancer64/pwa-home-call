# Lobby Screen

**Путь**: ./rules/web/ui/screens/lobby.md

## Назначение

Экран `lobby` демонстрирует текущую комнату и список доступных собеседников, чтобы пользователь мог инициировать вызов или выйти из комнаты без потери состояния.

## Основные этапы взаимодействия

1. `HomeCall_Web_Core_App` переводит состояние в `lobby`, обновляет контекст toolbar и передаёт `roomCode` plus `onlineUsers`, которыми управляет `HomeCall_Web_Net_SignalClient` (`online` события). Поле комнаты в шаблоне показывает текущую комнату, даже если пользователь не выбрал никого.
2. Список участников очищается и пересоздаётся при каждом вызове `showLobby`; для каждого пользователя рендерится карточка с кнопкой «Позвонить». Кнопка вызывает `onCall`, который делегирует начинание звонка `HomeCall_Web_Rtc_Peer` и заставляет `HomeCall_Web_Media_Manager` подготовить локальные дорожки.
3. Кнопка «Выйти» вызывает `signal.leave`, `signal.disconnect`, `peer.end` и возвращает пользователя на экран `enter`, не возвращая старые данные комнаты.
4. При появлении новых пользователей (`signal` эмитит `online`) `HomeCall_Web_Core_App` повторно запускает `showLobby`, чтобы синхронизировать список.

## Особенности и уведомления

- В `lobby` нет собственных toast-уведомлений, но `HomeCall_Web_Ui_Toast` остаётся доступной для команд toolbar`а (`info`, `settings`, `toggle-media`, `clear-cache`); так пользователь может увидеть контекстное сообщение о текущей комнате или попросить верифицировать состояние медиа.
- `HomeCall_Web_Media_Manager` подготавливает локальный поток заранее, чтобы при переходе в `call` видео сразу отображалось в миниатюре, а кнопка «Позвонить» воспринималась как мгновенное действие.
- `HomeCall_Web_Net_SignalClient` отвечает за отслеживание других участников, `HomeCall_Web_Rtc_Peer` — за подготовку канала и присвоение удалённой цели.

## Связи

- `ctx/rules/web/ui/screens.md` — основной схемы переходов и ролей.
- `ctx/rules/web/ui/screens/call.md` — непосредственный следующий экран после выбора собеседника.
