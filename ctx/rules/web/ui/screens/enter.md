# Enter Screen

**Путь**: ./rules/web/ui/screens/enter.md

## Назначение

Экран `enter` остаётся первой точкой взаимодействия, но теперь минималистичен: он показывает только бренд, поля для имени и кода комнаты, а также статус готовности устройств. Все активации (медиа, очистка кеша и обновления) перенесены в тулбар/гамбургер, чтобы пользователь мог войти без чтения длинных инструкций.

## Основные этапы взаимодействия

1. `HomeCall_Web_Core_App` очищает предыдущую комнату, грузит `userName` и `roomName` из `HomeCall_Web_Infra_Storage` и дополняет их `room`/`name` из URL (сценарий совместного подключения `ctx/product/scenarios/share-and-join.md`). Загрузившиеся значения попадают в форму и через `HomeCall_Web_Ui_Toast` уведомляют пользователя, что сохранённые данные готовы к подтверждению или редактированию.
2. `HomeCall_Web_Ui_Screen_Enter` применяет шаблон `enter`, связывает блок статуса с `HomeCall_Web_Media_Manager` и показывает компактное уведомление о состоянии устройств. Прямые действия по подготовке или переключению медиа делегированы `HomeCall_Web_Ui_Toolbar` (`toggle-media`), так что статус обновляется всегда, когда пользователь нажимает соответствующую кнопку на тулбаре или в меню.
3. При сабмите форма валидирует поля; если имя или комната пусты, `HomeCall_Web_Ui_Toast` показывает ошибку. При заполнении запускается `HomeCall_Web_Net_SignalClient.connect`, затем `signal.join`, а `HomeCall_Web_Infra_Storage.setUserData` сохраняет выбор (успех/ошибка транслируются в `toast` и `storage:saved`/`storage:failed` через `HomeCall_Web_Shared_EventBus`).
4. После удачного подключения экран сообщает `HomeCall_Web_Core_App` через коллбэк `onEnter`, `HomeCall_Web_Ui_Toast` отображает «Подключение установлено», и переход идёт в `lobby`.
5. При сбоях сигнализации или сохранения пользователь остаётся на экране с текстовыми подсказками и видимым сообщением об ошибке.

## Особенности и уведомления

- `HomeCall_Web_Media_Manager` держит локальный статус камеры/микрофона, обновляет индикатор `#media-status` и рассылает обновления через `media:state`/`media:status`; процессы включения/подготовки активируются через `HomeCall_Web_Ui_Toolbar` (`toggle-media`).
- `HomeCall_Web_Ui_Toast` служит основным каналом для сообщений: загрузка сохранённых данных, отказ доступа, сбой соединения, успешное сохранение (`Data saved`) и любые сообщения от Core о том, что `room`/`name` были дозаполнены по ссылке.
- `HomeCall_Web_Net_SignalClient` отвечает за `connect`/`join`, `HomeCall_Web_Infra_Storage` — за упаковку `userName`/`roomName` в `localStorage`, `HomeCall_Web_Shared_EventBus` рассылает события о сохранении, а `HomeCall_Web_Core_App` фиксирует текущее состояние и обновляет toolbar.

## Связи

- `ctx/rules/web/ui/screens.md` — родительский документ, фиксирующий сценарную последовательность.
- `ctx/rules/web/ui/toolbar.md` — описывает экран управления, где теперь собираются управляющие кнопки для медиа и кеша.
- `ctx/product/scenarios/share-and-join.md` — описывает поток URL-параметров `room`/`name`, который активирует часть логики этого экрана.
