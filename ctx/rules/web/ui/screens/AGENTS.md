# Связист screen contour

Path: `ctx/rules/web/ui/screens/AGENTS.md`

## Назначение

Этот index-файл каталога `screens/` описывает контур экранов Связиста и связывает отдельные state-документы с единой переходной картой.  
Контур ориентирован на `home → invite → call → end` без маршрутизации, с одним CTA на каждом экране и управлением через DI-контроллер, который инициирует медиа и сигналинг.

## Карта уровня

- `screens/` — контур экранов с собственной картой переходов и состояниями.
- `AGENTS.md` — текущий файл, координатор контурной карты и точка входа для агентного взаимодействия.
- `call.md` — описание состояния `call`, экран под видео собеседника и индикаторы управления.
- `end.md` — экран завершения с предложением начать новый сеанс и кнопкой возврата на главную.
- `home.md` — стартовое состояние с кнопкой «Позвонить» и моментальной генерацией ссылки.
- `invite.md` — экран приглашения, предлагающий копирование и шаринг ссылки, а также запуск звонка.
- `output.md` — вспомогательный экран отчётов и информации о звонке.
- `settings.md` — вспомогательный экран управления уведомлениями и настройками контуров.

## Состояния

1. **home** – единственный интерфейс для запуска нового звонка: кнопка **«Позвонить»**, подсказка «Ссылка создаётся автоматически», отсутствие полей ввода имени. Если `?session=<uuid>` уже передан, `Core` переключает экран на `call`, показывая статус «Подключение к сеансу…».
2. **invite** – появляется после генерации `sessionId`. Панель действий показывает ссылку, **«Скопировать ссылку»**, **«Поделиться»** (если `navigator.share` доступен) и **«Начать звонок»**, сохраняя трёхзонную компоновку без дополнительных форм.
3. **call** – экран под видео собеседника с нижней панелью **«Завершить звонок»**, локальной миниатюрой и верхним оверлеем для индикаторов камеры/микрофона. Кнопка **«Повторить»** появляется, если разрешения заблокированы.
4. **end** – сообщение «Звонок завершён», предложение начать новый сеанс и широкая кнопка **«Вернуться на главную»**, очищающая `sessionId` и возвращающая пользователя к `home`.

## Переходы

- `home → invite`: нажата **«Позвонить»**, Core генерирует `sessionId`, показывает ссылку и активирует `invite` без дополнительных форм.
- `home → call`: если окружение передало `session=<uuid>`, Core запускает подготовку медиа и сразу переходит в `call`.
- `invite → call`: **«Начать звонок»** вызывает `Media.prepare()`, `Net.startSignal(sessionId)` и `Rtc.startOutgoingSession(sessionId)`, затем рендерит `call`.
- `call → end`: любое завершение (через **«Завершить звонок»** или сбой сети) останавливает медиа, закрывает сигналинг и открывает `end`.
- `end → home`: **«Вернуться на главную»** очищает `sessionId` и сбрасывает интерфейс, возвращая пользователя к единственному CTA `home`.

## Обратная связь

- Ошибки медиа, сигналинга или шаринга показываются toast-уведомлениями, сохраняя пласты экранов чистыми.
- Оверлей `call` отражает статус `MediaManager`: **Готово**, **Приостановлено**, **Заблокировано** или **Не поддерживается**, чтобы пользователь видел ограничения оборудования.
