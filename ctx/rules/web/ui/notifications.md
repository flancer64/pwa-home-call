# Система toast-уведомлений `ctx/rules/web/ui/notifications.md`

## 1. Назначение

Система toast-уведомлений обеспечивает краткие визуальные сообщения о результатах действий и изменениях состояния в приложении ДомоЗвон.  
Toast — это ненавязчивое уведомление, которое появляется поверх интерфейса, не блокирует работу и исчезает автоматически.  
Система поддерживает последовательный показ нескольких сообщений и работает без событийных посредников.

---

## 2. Положение в архитектуре

Toast принадлежит уровню `Ui` и реализуется как DI-синглтон `HomeCall_Web_Ui_Toast$`.  
Он управляет собственным DOM-элементом и доступен всем контурам через контейнер зависимостей.  
Коммуникация с пользователем осуществляется напрямую, без `EventBus` или отдельных состояний.

---

## 3. Принципы

1. **Минимальность.** Уведомления создаются и исчезают автоматически, без ручного управления.
2. **Контекстность.** Каждое сообщение отражает конкретное действие пользователя или состояние системы.
3. **Последовательность.** При нескольких вызовах уведомления показываются по очереди из внутреннего буфера (FIFO).
4. **Единственность.** На экране отображается одно сообщение за раз.
5. **Детерминизм.** Визуальное поведение полностью контролируется модулем `HomeCall_Web_Ui_Toast$`.

---

## 4. Интерфейс

```js
toast.info(message, options);
toast.success(message, options);
toast.warn(message, options);
toast.error(message, options);
toast.hide();
```

**Параметры:**

- `message` — текст уведомления;
- `options.duration` — время отображения (мс, по умолчанию 4000);
- `options.icon` — путь к иконке, если нужно переопределить стандартную.

---

## 5. Поведение

- При вызове метода `info|success|warn|error` сообщение помещается в очередь.
- Пока одно уведомление отображается, остальные ожидают своей очереди.
- После скрытия текущего toast-а автоматически показывается следующее.
- `hide()` прерывает показ и инициирует переход к следующему уведомлению.
- Буфер очищается при перезагрузке страницы.
- Тип уведомления задаёт цвет, иконку и стиль.
- Контейнер создаётся автоматически, располагается по центру внизу экрана и адаптируется под мобильные устройства.

---

## 6. Типы уведомлений

| Тип         | Назначение                        | Цвет/иконка | Пример текста             |
| ----------- | --------------------------------- | ----------- | ------------------------- |
| **info**    | информационное сообщение          | синий (ℹ)   | «Подключение установлено» |
| **success** | успешное завершение действия      | зелёный (✓) | «Настройки сохранены»     |
| **warn**    | предупреждение или нестабильность | жёлтый (!)  | «Камера недоступна»       |
| **error**   | ошибка или сбой                   | красный (✖) | «Ошибка соединения»       |

---

## 7. Правила использования

1. Использовать toast только для кратких сообщений.
2. Не дублировать одинаковые уведомления.
3. Формулировать тексты утвердительно и локализованно.
4. Длительность показа — 3–6 секунд.
5. Все сообщения дублируются в лог `HomeCall_Web_Shared_Logger$`.

---

## 8. Интеграция

| Контур    | Пример использования                     |
| --------- | ---------------------------------------- |
| **Core**  | статусы запуска и завершения приложения  |
| **Media** | доступность устройств (камера, микрофон) |
| **Net**   | состояние сети и ошибки соединения       |
| **Rtc**   | статусы соединения                       |
| **Pwa**   | обновления версии и кэша                 |
| **Ui**    | подтверждения пользовательских действий  |

---

## 9. Связи

- `ctx/rules/web/contours/ui.md` — общие принципы интерфейса;
- `ctx/rules/web/style.md` — визуальное оформление и адаптивность;
- `ctx/rules/web/app.md` — сценарии отображения уведомлений;
- `ctx/rules/web/contours/shared.md` — логирование ошибок.

---

## 10. Итог

Toast-уведомления — минимальный, автономный и предсказуемый механизм обратной связи в ДомоЗвон.
Они информируют пользователя о состоянии системы, поддерживают очередь сообщений и не требуют внешних зависимостей.
