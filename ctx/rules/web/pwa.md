# Прогрессивное веб-приложение HomeCall

Этот документ конкретизирует раздел "Поведение PWA" из `app.md`, описывая реализацию автономности, кеширования и обновления версии браузерного приложения.
## Назначение

Документ определяет принципы реализации и поведения **PWA-версии HomeCall**.  
Цель — зафиксировать минимальные требования к манифесту, сервис-воркеру и механизму обновления, обеспечивающему автономную работу фронтенда.

## Границы и интерфейсы

Документ ограничен описанием автономного поведения PWA HomeCall и не касается серверной логики или деталей реализации контуров, расписанных в `app.md`.

---

## 1. Состав компонентов

- **`manifest.json`** — метаданные приложения:

  - `name`, `short_name`, `description`;
  - `start_url` = `"./index.html"`;
  - `display` = `"standalone"`;
  - `background_color`, `theme_color`;
  - иконки в `assets/icons/` (разрешения 192×192 и 512×512).

- **`service-worker.js`** — кэширование и офлайн-доступ:

  - предзагрузка основных файлов (`index.html`, `app.js`, `manifest.json`, `assets/style.css`);
  - автоматическое обновление при изменении версии;
  - управление событиями `install`, `activate`, `fetch`.

- **`version.json`** — файл версии, обновляемый сервером при каждой сборке.

---

## 2. Поведение PWA

1. При первом запуске браузер регистрирует `service-worker.js`.
2. Сервис-воркер сохраняет файлы из списка кеша.
3. При последующих запусках приложение работает из кеша.
4. Периодически `app.js` запрашивает `version.json`.
5. Если версия изменилась, воркер очищает старый кеш и обновляет ресурсы.
6. Пользователь получает новое приложение без ручного обновления.

---

## 3. Принципы реализации

- Все запросы кешируются с помощью `CacheStorage`.
- Версии кеша именуются по шаблону: `homecall-v{number}`.
- При обновлении старые кеши удаляются.
- Оффлайн-режим поддерживает только основной экран (`index.html`).
- Никакие динамические данные (сигналинг, медиапотоки) не кешируются.
- Приложение полностью автономно, не требует установки из магазина.

---

## Связи

- `./app.md` — поведение PWA и обновление версии в рамках сценариев приложения.
- `../arch/front.md` — архитектура фронтенда.
- `./structure.md` — файловая организация PWA.
- `./rtc.md` — ограничения офлайн-режима для WebRTC.

---

## Итог

Документ задаёт правила функционирования PWA HomeCall:  
манифест определяет параметры установки, сервис-воркер обеспечивает офлайн-работу и обновление версии, а файл `version.json` синхронизирует клиента с сервером.  
Эта структура делает приложение автономным, предсказуемым и устойчивым к потере соединения.
См. также `app.md` — обзорный документ браузерного приложения HomeCall.
