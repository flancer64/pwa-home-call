# Контур Shared — инфраструктура

Этот документ описывает **Shared** — набор кросс-контурных сервисов браузерного слоя Приложение, которые организуются через `@teqfw/di` и доступны другим контурам без использования шины событий.

## Назначение

Shared предоставляет единое место для логгирования, конфигурации и утилит, которые поддерживают предсказуемый обмен данными между контурами. Компоненты Shared не управляют бизнес-логикой, но обеспечивают согласованное поведение через явные вызовы и переданные зависимости.

> **Согласованность с продуктом:** `ctx/product/overview.md` и `ctx/product/capabilities/connection.md` требуют, чтобы логирование, статусы и ID оставались внутри текущего окна (`ready/waiting/active`) и не всплывали как отдельные экраны. Shared обеспечивает это через `Logger`, `Util` и `ToastFactory`, а будущий rework в `ctx/agent/plan/2025/11/20251129-rules-implementation-fixes.md` покажет, как они подключаются к новой state machine без изменения DI-интерфейсов.

## Компоненты

| Компонент | Назначение |
| --- | --- |
| `HomeCall_Web_Shared_Logger$` | структурированное логгирование (контексты `core`, `media`, `net`, `ui`, `env`). |
| `HomeCall_Web_Shared_Config$` | параметры сборки и флаги окружения, которые инжектируются в зависимые сервисы. |
| `HomeCall_Web_Shared_Util$` | генераторы UUID, обёртки `storage.get/set`, помощники по формированию `toast`-сообщений и повторных попыток. |

Shared не содержит шины событий; вместо этого контуры получают нужные коллбэки и интерфейсы напрямую из контейнера.

## Типичные DI-зависимости

- `HomeCall_Web_Shared_Logger$`
- `HomeCall_Web_Shared_Config$`
- `HomeCall_Web_Shared_Util$`
- `HomeCall_Web_Shared_ToastFactory$` (если используется)

## Контейнер и взаимодействия

Shared регистрируется в `@teqfw/di` как набор сервисов (`HomeCall_Web_Shared_*`). Остальные контуры запрашивают эти сервисы через контейнер и используют их внутри методов вместо публикации событий. Это упрощает трассировку и делает взаимодействие предсказуемым: `Core`, `Media` и `Net` могут логировать состояния и обращаться к утилитам без посредников.

## Связи

- `ctx/rules/web/app.md` — общая координация состояния и `toast`-статусов, которые логируются Shared.
- `ctx/rules/web/contours/core.md` — Core использует `Logger` и `Util` для управления типами сценариев и генерации UUID.
- Остальные контуры (`media`, `net`, `rtc`, `ui`, `env`) получают конфигурацию, логгер и утилиты напрямую из контейнера Shared.

## Итог

Контур Shared гарантирует, что все вспомогательные сервисы инжектируются через DI и доступны везде без событийной шины. Это соответствует новой архитектуре Tequila Framework, которая полностью полагается на контейнер зависимостей и прямые вызовы между компонентами.
