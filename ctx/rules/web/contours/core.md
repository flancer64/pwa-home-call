# Контур Core и оркестрация

Этот документ описывает контур **Core**, являющийся частью браузерного приложения HomeCall, определённого в `app.md`.

## Назначение

`HomeCall_Web_Core_App$` — единственная точка оркестрации фронтенда: она управляет жизненными циклами, фиксирует переходы состояний, концентрирует внутриконтурные коллбэки и инициирует события в `Shared.EventBus`. Core не содержит бизнес-логики, но формирует сигналы для Ui, Media, Net и Env.

## Границы и интерфейсы

- **Входные воздействия**: коллбэки от `Env.Provider` (изменения переменных окружения), сигналы от `Net` о статусе каналов, уведомления `Media` о готовности устройств, результаты UI-действий (`ui:action`).
- **Выходные сигналы**: события `core:state`, `core:ready`, `core:shutdown` на `Shared.EventBus`; коллбэки на `Ui` для переключения экранов и подтверждения разрешений; команды `Media` и `Rtc` на старт/стоп потоков; запросы `Net` на подключение/переподключение.
- **Оркестрационные сценарии**: Core собирает состояния (`Env`, `Net`, `Media`) через DI, сверяет их в state machine и переводит браузер в новое состояние (логика `VersionWatcher`, `CallSession`).

## Типичные DI-зависимости

- `HomeCall_Web_Core_App$`
- `HomeCall_Web_Core_StateMachine$`
- `HomeCall_Web_Shared_EventBus$`
- `HomeCall_Web_Shared_Logger$`
- `HomeCall_Web_Env_Provider$`
- `HomeCall_Web_Ui_ScreenFactory$`
- `HomeCall_Web_Net_SignalClient$`
- `HomeCall_Web_Media_DeviceManager$`

## Контейнер и взаимодействия

Core получает все зависимости только через `@teqfw/di`; никакие `import`-ы из других контуров не разрешены. В рантайме DI обеспечивает позднее связывание: агенты и тесты могут подставить фиктивные `Env`, `Net` или `Shared.EventBus`, и Core сразу начнёт работать с этими реализациями. Core также отвечает за регистрацию состояний в контейнере, чтобы остальные области могли подписаться на актуальные события.

## Связи

- `ctx/rules/web/app.md` — сценарии состояний, переходы и вызовы `core:state`.
- `ctx/rules/web/contours/ui.md` — команды на переключение UI.
- `ctx/rules/web/contours/net.md` — сигналы и события сетевого слоя.
- `ctx/rules/web/contours/media.md` — управление потоками и разрешениями устройств.
- `ctx/rules/web/contours/env.md` — запрос и обновление контекста окружения.
- `ctx/rules/web/contours/shared.md` — `EventBus` и логгер.

## Итог

Контур Core координирует состояния, события и переходы браузерного приложения HomeCall, определённого в `app.md`.  
Он обеспечивает связность всех остальных контуров без привязки к конкретным реализациям.
См. также `app.md` — обзорный документ браузерного приложения HomeCall.
