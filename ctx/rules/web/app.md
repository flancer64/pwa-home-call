# Браузерное приложение проекта Связист

## Назначение

Документ описывает поведение браузерного приложения Связист как единой системы.  
Он фиксирует роль `HomeCall_Web_Core_App`, которая управляет жизненным циклом `home → invite → call → end`, синхронизирует UI, медиа и сеть и исключает лишние экраны, формы или настройки.  
UI-переходы и CTA-действия подробно описаны в `ctx/rules/web/ui/screens.md`, а этот документ вместе с `contours/core.md` концентрируется на техническом потоке, который запускает `Media`, `Net` и `Rtc`.

---

## 1. Роль приложения

- Оркеструет контуры Core, Ui, Media, Net, Rtc, Env, Infra и Shared, удерживая поток строго в рамках последовательности `home → invite → call → end`.
- Генерирует новый `sessionId` при нажатии **«Позвонить»**, подключает генератор ссылок (`share-link`), формирует `/?session=<uuid>` и показывает экран `invite`, оставаясь в `home` до начала звонка.
- Управляет переходом в `call`, когда пользователь нажимает **«Начать звонок»** или когда визит по приглашённой ссылке содержит `session`-параметр: Core готовит медиапотоки, WebRTC и сигналинг, а затем прокидывает команды Ui/Media/Net.
- Поддерживает единую линию локальных состояний: flat `sessionId`, `callState`, `toast`-уведомления и сброс `sessionId` после окончания звонка, без лишних форм или хранения персональных данных.
- Обеспечивает PWA-поведение: устойчивость к обновлениям и отказам, показ статусов через `HomeCall_Web_Ui_Toast` и минимальное взаимодействие с локальным хранилищем (только PWA-метаданные).

---

## 2. Принципы работы

1. **Цикл `home → invite → call → end`.**  
   Связист сразу создаёт UUID-сеанс, показывает экран приглашения и лишь затем запускает WebRTC. `home` всегда готовит пользователя к звонку одной кнопкой, `invite` демонстрирует ссылку и кнопки копирования/поделения, `call` управляет медиапотоками, `end` завершает сеанс.
2. **Домашний экран без форм.**  
   `home` содержит один крупный CTA **«Позвонить»** и текст «Ссылка создаётся автоматически». Нет полей ввода, нет хранения имени — вся необходимая информация появляется динамически и исчезает после завершения сеанса.
3. **Экран приглашения.**  
   После генерации `sessionId` `invite` показывает ссылку `https://<домен>/?session=<uuid>`, два действия (**«Скопировать ссылку»**, **«Поделиться»**) и кнопку **«Начать звонок»**. Пользователь может отправить ссылку, а затем самостоятельно инициировать WebRTC.
4. **Автоподключение по ссылке.**  
   При открытии URL с параметром `?session=<uuid>` `Env` передаёт `sessionId` Core, и приложение сразу переходит в подготовку WebRTC: `invite` может быть пропущен, а `call` открывается после готовности устройств.
5. **Сигналинг и WebRTC.**  
   `call` управляет медиапотоками, включая индикаторы состояния камеры и микрофона. `Core` инициирует `Net.startSignal(sessionId)` и `Rtc.startOutgoingSession(sessionId)`/`startIncomingSession(sessionId)` в зависимости от роли. Статусы транслируются через тосты (`Готово`, `Связь потеряна`, `Повторить`).
6. **Завершение и сброс.**  
   После нажатия **«Завершить звонок»** или при разрыве `Core` вызывается `Media.stopMedia()`, `Net.stopSignal()`, `Ui.showEnd()`, очищает сохранённый `sessionId` в памяти и предлагает вернуться на новый вызов без сохранения каких-либо персональных данных.

---

Любое состояние логируется через `HomeCall_Web_Shared_Logger$`, а текстовые подсказки остаются русскоязычными и минимальными.  
`HomeCall_Web_Core_App` обеспечивает однокнопочный путь к звонку и исключает любые «комнаты» или «имена» из пользовательского потока.
