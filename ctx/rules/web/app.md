# Браузерное приложение проекта ДомоЗвон

## Назначение

Документ описывает поведение браузерного приложения ДомоЗвон как единой системы.  
Он фиксирует роль `HomeCall_Web_Core_App`, которая управляет жизненным циклом, синхронизацией состояния UI, медиа и сети, не допуская сложных меню, toolbar или множественных экранов.

---

## 1. Роль приложения

- Оркеструет контуры Core, Ui, Media, Net, Rtc, Env и Shared, обеспечивая заданный порядок действий: `home → call → end`.
- Поддерживает PWA-характеристики: автономность, обновление и устойчивость при потере соединения.
- Обеспечивает однокнопочный опыт: вся логика создания комнаты и ссылки сосредоточена в `home`, пользователь не выбирает комнаты или участники вручную.
- Гарантирует, что имя пользователя сохраняется локально один раз (`name` в `localStorage`), а остальные параметры подтягиваются автоматически.
- Передаёт статусы через `HomeCall_Web_Ui_Toast` и возвращает управление при завершении звонка без дополнительных экранов.

---

## 2. Принципы работы

1. **Однокнопочный цикл.**  
   Пользователь открывает ДомоЗвон, нажимает «Позвонить» и ждёт подключения собеседника; всё остальное (комната, ссылка, media) происходит автоматически.
2. **Минимализм интерфейса.**  
   Нет toolbar, гамбургеров или меню: все управления размещаются в основной области (`home`, `call`, `end`), а `toast` сообщает статус.
3. **Имя однажды.**  
   При первом запуске отображается одно поле для имени; после сохранения оно больше не запрашивается и всегда используется в ссылках.
4. **Автоподключение по ссылке.**  
   Параметр `room=<uuid>` передаётся через URL, `home` подхватывает его и сразу инициирует соединение без дополнительных действий пользователя.
5. **Ориентация на пожилых пользователей.**  
   Крупные кнопки, быстрые статусы и минимум текста обеспечивают понятность и лёгкость использования.

---

## 3. Состояния и переходы

| Состояние | Назначение |
| --------- | ---------- |
| **home**  | Главное окно: однократный сбор имени, кнопка «Позвонить», генерация ссылки и вызов механизма `share-link.md`. |
| **call**  | Активный звонок: поток собеседника, миниатюра локального стрима, кнопка «Завершить» и `toast`-статусы соединения. |
| **end**   | Текстовое сообщение о результате и кнопка «Главный экран», возвращающая пользователя в `home`. |

### Переходы

- `home → call`: нажата кнопка «Позвонить», `HomeCall_Web_Core_App` генерирует UUID-комнату и ссылку, инициатор получает `toast` «Ссылка готова», UI переходит в `call`, где отображается подключение.
- `home (по ссылке) → call`: при запуске с `?room=<uuid>` `home` пропускает нажатие и берёт UUID из URL, затем автоматически переводит в `call`, если имя пользователя уже сохранено.
- `call → end`: завершение вызова (ручное или сетевое) вызывает `endCall`, останавливает медиа и показывает экран результата.
- `end → home`: пользователь нажимает «Главный экран», состояние очищается, ссылка сбрасывается, но имя сохраняется, чтобы можно было снова нажать «Позвонить».
- Внутри `call` могут показываться `toast` о повторных попытках подключения; экран не переключается на дополнительные состояния, пока `call` активен.

---

## 4. Жизненный цикл и взаимодействия

- `HomeCall_Web_Core_App` координирует `HomeCall_Web_Media_Manager`, `HomeCall_Web_Net_SignalClient` и `HomeCall_Web_Rtc_Peer`, поддерживая связь между стадиями.
- `home` вызывает `share-link.md` для генерации, Web Share API и fallback; `toast` сообщает «Ссылка готова» или «Скопировано».
- `call` обновляет медиаэлементы: `#remote-video`, `#local-miniature`, `#no-media`. Любые ошибки (сеть, медиа) отображаются через `notifications.md`.
- `end` получает `connectionMessage` и использует его для пояснений; после возврата в `home` `share-link` очищает одноразовую ссылку, но сохраняется имя.
- Нет событий `ui:action:share-link`, `ui:action:settings` или других toolbar-акций — всё управляется локальными методами `home`.

---

## 5. Связи

- `ctx/rules/web/ui/home.md`, `share-link.md`, `screens.md`, `screens/call.md`, `screens/end.md` — описывают экранные состояния и их взаимодействие.
- `ctx/product/overview.md`, `features.md`, `features/invite.md` — задают продуктовые ограничения: однокнопочный звонок, автоматическое создание комнаты, сохранение имени и минимальный интерфейс.
- `ctx/product/scenarios/first-run.md`, `daily-use.md`, `primary-call.md` — детализируют первые шаги, ежедневные потоки и основной вызов.
- `ctx/rules/web/notifications.md` — `toast`-статусы о ссылке, медиа и сетевых ошибках.
