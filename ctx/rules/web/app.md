# Центральный модуль приложения (`ctx/rules/web/app.md`)

## Назначение

Документ определяет роль и обязанности главного модуля фронтенда **HomeCall** — файла `app.js`.  
Цель — зафиксировать его функции как координатора состояния приложения, не содержащего бизнес-логики или визуальных деталей.

---

## 1. Роль

- `app.js` — единая точка входа для всего клиентского кода.
- Управляет жизненным циклом приложения и состояниями экранов:  
  **вход → лобби → звонок → завершение**.
- Инициализирует и связывает между собой внутренние модули:
  - `ws/client.js` — сигналинг по WebSocket;
  - `rtc/peer.js` — создание и управление WebRTC-соединением;
  - `ui/` — шаблоны экранов и элементы интерфейса;
  - `service-worker.js` — регистрация и обновление кеша.

---

## 2. Принципы работы

- При загрузке `app.js` регистрирует `service-worker.js` и подключается к серверу сигналинга.
- После успешного подключения отображает экран лобби с онлайн-списком.
- При выборе собеседника запускает процесс установления WebRTC-сессии.
- При завершении или ошибке — возвращает пользователя к экрану лобби.
- Все переходы реализуются через внутреннее состояние и обновление DOM, без перезагрузки страницы.
- Используется только нативный JavaScript (без фреймворков).

---

## 3. Состояния приложения

| Состояние | Назначение                                         |
| --------- | -------------------------------------------------- |
| `enter`   | ввод кодового слова комнаты и вход в систему       |
| `lobby`   | отображение списка пользователей и ожидание вызова |
| `call`    | активное соединение WebRTC                         |
| `end`     | завершение вызова, возврат к лобби                 |

Смена состояний управляется внутренними функциями `setState(name)` и обработчиками событий.

---

## 4. Требования

- Логика событий должна быть изолирована от визуальной части.
- Все сетевые вызовы и обработчики ошибок делегируются модулям `ws/` и `rtc/`.
- Код должен быть читабелен, документирован и использовать только ES6+.
- Комментарии и сообщения в коде — на английском языке.

---

## 5. Связи

- `./structure.md` — структура каталогов и расположение `app.js`.
- `./ui/screens.md` — модель интерфейсных экранов.
- `./ws.md` — формат обмена по WebSocket.
- `./rtc.md` — взаимодействие через WebRTC.
- `./pwa.md` — регистрация сервис-воркера и обновление версии.

---

## Итог

Модуль `app.js` — это координатор HomeCall PWA, управляющий состояниями приложения и взаимодействием между компонентами.  
Он связывает интерфейс, сигналинг и WebRTC, сохраняя архитектурную чистоту и простоту реализации.
