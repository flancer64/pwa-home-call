# Браузерное приложение проекта ДомоЗвон

## Назначение

Документ описывает **поведение браузерного приложения ДомоЗвон** как целостной системы.  
Он фиксирует роль центрального уровня приложения, который управляет жизненным циклом, состояниями экранов и взаимодействием пользователя с системой.  
Документ не описывает конкретные классы, файлы или DI-зависимости — это обзорная модель поведения фронтенда.

---

## 1. Роль приложения

- Является **точкой координации** всех контуров фронтенда (Core, Ui, Media, Net, Rtc, Env, Shared).
- Управляет жизненным циклом браузерного приложения и последовательностью экранов:  
  **вход → лобби → звонок → завершение → лобби**.
- Обеспечивает непрерывное взаимодействие пользователя с интерфейсом, устройствами и сетью без перезагрузки страницы.
- Определяет, когда и как активируются функции, связанные с медиа, сетью, отображением и состоянием интерфейса.
- Поддерживает поведение PWA: автономность, обновление версии и устойчивость при потере соединения.

---

## 2. Принципы работы

1. **Единство потока взаимодействия.**  
   Приложение воспринимается пользователем как один непрерывный процесс — от входа до завершения вызова.

2. **Сценарное управление состояниями.**  
   Переход между экранами выполняется внутри приложения по внутренней логике состояний, без перезагрузки или смены URL.

3. **Событийное взаимодействие.**  
   Все реакции между функциональными областями происходят через систему событий, без прямых связей между подсистемами.

4. **Позднее включение медиадоступа.**  
   Разрешения на использование камеры и микрофона запрашиваются только после действия пользователя.

5. **Работа в офлайн-режиме.**  
   Приложение продолжает функционировать при потере соединения, сохраняя интерфейс и доступ к последнему состоянию.

6. **Нативная основа.**  
   Используется только стандартный JavaScript и API браузера. Приложение не зависит от внешних фреймворков.

---

## 3. Сценарии и состояния

| Состояние | Назначение                                                             |
| --------- | ---------------------------------------------------------------------- |
| **enter** | Пользователь вводит имя и код комнаты, подготавливает медиаустройства. |
| **lobby** | Пользователь видит других участников и выбирает собеседника.           |
| **call**  | Активное соединение между пользователями (видео и/или аудио).          |
| **end**   | Завершение вызова, отображение итогового сообщения и возврат к лобби.  |

Переходы между состояниями управляются внутренним механизмом приложения, обеспечивающим согласованность интерфейса, медиа и сети.

---

## 4. Поведение при взаимодействии с пользователем

- **Первое подключение.**  
  Отображается экран с объяснением необходимости разрешений. Пользователь сам инициирует запрос к камере и микрофону.

- **Отказ или сбой доступа.**  
  Интерфейс показывает понятное уведомление и инструкцию, как восстановить доступ.

- **Восстановление устройств.**  
  При возвращении камеры или микрофона система автоматически уведомляет пользователя и возобновляет работу.

- **Завершение вызова.**  
  Приложение аккуратно освобождает ресурсы, закрывает соединения и возвращает пользователя к состоянию готовности.

---

## 5. Структура и организация приложения

- Приложение состоит из **взаимосвязанных контуров**, каждый из которых отвечает за собственную область:

  - **Core** — координация состояний и событий;
  - **Ui** — экранное отображение и действия пользователя;
  - **Media** — управление устройствами и разрешениями;
  - **Net** — обмен сигналами через WebSocket;
  - **Rtc** — установление и поддержка соединений WebRTC;
  - **Env** — доступ к объектам среды браузера;
  - **Shared** — общие инфраструктурные сервисы (логирование, события, утилиты).

- Контуры связаны через общую событийную модель, а не прямыми вызовами.
- Приложение формирует единое состояние, объединяющее все эти области.

---

## 6. Поведение PWA

- Приложение работает как **прогрессивное веб-приложение**:
  - при первом запуске регистрируется сервис-воркер;
  - ресурсы кэшируются и доступны офлайн;
  - при изменении версии выполняется автоматическое обновление;
  - пользователь всегда работает с актуальной версией без ручных действий.
  - панель управления содержит единственную ручную кнопку **«Очистить кэш»**, которая сбрасывает локальные кэши и сервис-воркеры и сразу же перезапускает приложение для повторной инициализации ресурсов текущей сборки.

---

## 7. Согласованность с контекстом документации

Документ `app.md` описывает **высокоуровневое поведение браузерного приложения**.  
Технические детали (модули, классы, события, зависимости) раскрываются в отдельных документах соответствующих контуров:

- `core.md` — оркестрация и логика состояний;
- `ui.md` — экраны и пользовательские действия;
- `media.md` — управление устройствами;
- `net.md` — сигналинг и WebSocket;
- `rtc.md` — обмен медиапотоками;
- `env.md` — среда выполнения;
- `shared.md` — инфраструктура и события;
- `pwa.md` — автономность и обновление версии.

---

## Итог

Фронтенд ДомоЗвон — это единое браузерное приложение, управляемое внутренним механизмом состояний.  
Оно объединяет все контуры в согласованный пользовательский опыт, где интерфейс, сеть и медиа действуют как части одной системы.  
Документ фиксирует архитектурное поведение этого уровня без привязки к конкретным реализациям.
