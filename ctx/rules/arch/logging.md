# Компонент логирования

## Назначение

Определяет единые правила логирования в проекте **HomeCall**.
Используется один логгер в namespace `HomeCall_Web_`, применяемый как во фронтенде, так и в бэкенде.
Логгер формирует локальный вывод и при необходимости дублирует сообщения на удалённый сервер.

## Логическая структура

- **Контракт:** `HomeCall_Web_Contract_Logger`
  Описывает методы `debug`, `info`, `warn`, `error`.

- **Реализация:** `HomeCall_Web_Logger`
  Универсальный логгер для браузера и Node.
  Внедряется через DI как синглтон; логика одинакова для обеих сред.

## Принципы

- Все обращения к логированию идут только через внедрённый логгер.
- Формат сообщения единый:

  ```text
  [LEVEL] [namespace] message
  ```

- Логгер не знает, где и как хранится конфигурация (включение удалённого логирования, канала, режима).
  Управляющие значения подаёт внешний код через DI.
- Логгер сам определяет среду выполнения (браузер / Node) и использует соответствующий способ отправки.
- Логгер имеет методы для включения/выключения удалённого логирования, а также для получения состояния удалённого логирования.

## Удалённое логирование

Логгер поддерживает дублирование сообщений на удалённый сервер **только если это включено внешней конфигурацией**.

- **Фронтенд:** параметр включается из панели настроек приложения.
- **Бэкенд:** параметр включается через переменные окружения, например `HC_REMOTE_LOGGING=1`.
- Адрес удалённой консоли фиксирован:

  ```text
  https://console.wiredgeese.com/
  ```

- Логгер отправляет сообщения методом:

  - `navigator.sendBeacon()` — если доступен браузеру;
  - `fetch()` — во всех остальных случаях (Node и fallback).

Ошибки удалённой отправки игнорируются и не влияют на основной поток логирования.

## Идентификатор приложения

Для различения источников логов каждый экземпляр логгера при создании генерирует **4-значный случайный код**:

- код создаётся один раз при старте (синглтон DI);
- хранится только в оперативной памяти;
- добавляется ко всем удалённым сообщениям:

  ```text
  [1234] [LEVEL] [namespace] message
  ```

Код облегчает анализ поведения нескольких клиентов (смартфоны, десктоп, бэкенд) в едином канале удалённой консоли.

## Результат

Проект использует **один общий логгер**, одинаковый для браузера и Node.
Он поддерживает локальный вывод, удалённое логирование, идентификацию источника и единый формат сообщений.
Конфигурация режима работы полностью контролируется внешними компонентами и не влияет на архитектуру логгера.
