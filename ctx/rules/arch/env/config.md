# Конфигурация окружения (`ctx/rules/arch/env/config.md`)

## Назначение

Документ описывает систему конфигурации backend-приложения **Связист** и перечень параметров, задаваемых через файл `.env`.  
Эти параметры определяют сетевое окружение, поведение API и WebSocket-сервера, а также видимость приложения во внешней среде.

---

## 1. Принципы конфигурации

- Все переменные среды загружаются из файла `.env` с помощью пакета `dotenv`.
- Конфигурация применяется при запуске `bin/server.js` до инициализации DI-контейнера.
- Параметры группируются по назначению: _сетевые_, _системные_, _служебные_.
- Отсутствие обязательных параметров трактуется как ошибка конфигурации.
- Все значения передаются как строки и не должны содержать пробелов вокруг знака `=`.

---

## 2. Основные параметры `.env`

| Переменная    | Пример                       | Назначение                                                   |
| ------------- | ---------------------------- | ------------------------------------------------------------ |
| `PORT`        | `3000`                       | Порт HTTP API, обслуживаемого через `@flancer32/teq-web`.    |
| `WS_PORT`     | `3001`                       | Порт WebSocket-сервера сигналинга.                           |
| `HOST_PUBLIC` | `call.dev.wiredgeese.com`    | Внешнее имя хоста, под которым сервер доступен через Apache. |
| `NODE_ENV`    | `production` / `development` | Режим выполнения.                                            |

---

## 3. Использование параметров в коде

- `bin/server.js` загружает `.env` и передаёт значения в контейнер зависимостей.
- `HomeCall_Back_App` использует `PORT` и `WS_PORT` при запуске серверов.
- Модули, формирующие внешние URL (например, для ссылок внутри REST API), используют `HOST_PUBLIC`.

---

## 4. Безопасность и развёртывание

- Файл `.env` не коммитится в репозиторий и хранится локально на сервере.
- Все сетевые порты (`PORT`, `WS_PORT`) должны быть доступны только из локальной сети, если используется Apache-проксирование.
- Изменение значений требует перезапуска Node.js-процесса.
- Для production-развёртывания рекомендуется контролировать переменные через системный менеджер процессов (например, `systemd`).

---

## 5. Связи

- `./node.md` — структура Node.js-окружения.
- `./apache.md` — взаимодействие с внешним HTTP-сервером.
- `../back.md` — архитектура backend-приложения.
- `../back/signal.md` — сервер сигналинга, использующий `WS_PORT`.

---

## Итог

Файл `.env` является единственным источником параметров окружения для backend Связист.  
Он задаёт порты API и сигналинга, внешнее имя хоста, протокол и уровень логирования, обеспечивая согласованность конфигурации между сервером и внешней инфраструктурой.
