# Правила применения контейнера @teqfw/di в проекте HomeCall

## Назначение

Документ фиксирует минимальные правила использования контейнера зависимостей **@teqfw/di** для корректной сборки модулей проекта **HomeCall**, построенного по философии **TeqFW**.  
Определяет соглашения для агента Codex при генерации и изменении кода.

---

## 1. Контейнер и структура

- Контейнер создаётся один раз при старте Node.js-сервера.
- Используется late binding и IoC: зависимости внедряются динамически.
- Корень namespace: `HomeCall_`, каталог `src/`.
- Пример: `HomeCall_App` → `src/App.js`.

---

## 2. Типы модулей

- **Data** — enum, DTO, фабрики.
- **Logic** — обработчики, координаторы.
- Один модуль — одна роль.
- Внутри модулей `import` запрещён.

---

## 3. Экспорты и зависимости

- Допустимые формы экспорта:
  - `default` object — константы;
  - `default` factory-function — принимает `{deps}`;
  - `default` class — конструктор `({deps})`.
- Все зависимости передаются через один объект `deps`, деструктурируются сразу и плоско.

---

## 4. Идентификаторы зависимостей

| Формат                       | Значение                   |
| ---------------------------- | -------------------------- |
| `Ns_Component$`              | default-экспорт, singleton |
| `Ns_Component$$`             | новый экземпляр            |
| `Ns_Component.name$`         | именованный экспорт        |
| `node:pkg` / `node:pkg.name` | внешние пакеты             |

Ключи не сокращаются и не переименовываются.  
`A_B_C` → `A/B/C.js`.

---

## 5. Жизненный цикл

- Контейнер создаёт экземпляры по требованию.
- Singleton-объекты кэшируются.
- Модули изолированы, тестируются независимо.
- Зависимости можно подменять моками.

---

## 6. Инициализация

Пример:

```js
import Container from "@teqfw/di";

const c = new Container();
const r = c.getResolver();
r.addNamespaceRoot("HomeCall_", import.meta.resolve("../src"));

const app = await c.get("HomeCall_App$");
await app.run();
```

---

## 7. Стиль и контроль

- Код и логи — только на английском.
- Все файлы соответствуют схеме имён namespace.
- Каждый модуль снабжён JSDoc.
- Unit-тесты обязательны для логических модулей.

---

## Результат

Агент Codex использует данные правила для генерации и проверки DI-совместимых модулей проекта HomeCall.
