# Правила модульного тестирования HomeCall

## Назначение

Документ определяет единые требования к модульному тестированию проекта **HomeCall** на основе контейнера зависимостей `@teqfw/di`.  
Он задаёт структуру тестов, порядок их организации и критерии проверки корректности реализации без избыточных деталей.

## Покрытие

- Каждый модуль из `src/` имеет зеркальный unit-тест в `test/unit/`.
- Тест проверяет только публичное поведение модуля, не обращаясь к внутренним структурам.
- Все компоненты (`Namespace_*`) создаются контейнером и тестируются в рабочей конфигурации приложения.

## Структура каталогов

```text
project-root/
├── src/
├── test/
│   └── unit/
│       ├── helper.mjs
│       └── Back/
│           └── Logger.test.mjs
```

## Организация тестов

- Для каждого файла `src/Area/Module.js` создаётся тест `test/unit/Area/Module.test.mjs`.
- Все тесты используют общий helper `./test/unit/helper.mjs`, создающий чистый контейнер зависимостей:

```js
import { createTestContainer } from "../helper.mjs";
const container = await createTestContainer();
const logger = await container.get("HomeCall_Back_Logger$");
```

- Каждый тест выполняется в изолированном контейнере и взаимодействует с кодом только через `container.get()`.

## Инструменты

- Используется встроенный модуль `node:test` и проверки `node:assert/strict`.
- Тесты должны быть идемпотентны и не изменять состояние проекта.
- Все сообщения и логи — на английском языке.

## Контроль регрессий

- Тесты фиксируют интерфейс модулей: имена, сигнатуры, формат вывода.
- Изменение интерфейса допускается только после обновления контекста и пересогласования тестов.
- Ошибки при `node --test` трактуются как нарушение согласованности кодовой базы.

## Ссылки

- `./teqfw/di.md` — принципы контейнера зависимостей, воспроизводимые в тестах.
- `./teqfw/module-template.md` — эталон структуры модулей для тестирования.
- `../architecture.md` — архитектурные связи и перечень тестируемых ролей.

## Итог

Документ обеспечивает единообразие тестовой среды и фиксирует контракт между модулями, контейнером и тестами.
Он гарантирует воспроизводимость, структурную целостность и защиту проекта **HomeCall** от регрессий.
