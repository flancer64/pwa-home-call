# Возможность: структура и жизненный цикл сеанса

Path: `./ctx/docs/product/capabilities/session.md`

## Инвариант сеанса

Сеанс — логическая единица, связываемая `sessionId`-ссылкой, которая сама по себе не назначает роли и обслуживает ровно двух участников; инварианты совпадают независимо от того, кто объявил слот, предоставил ссылку третьей стороне или в каком порядке появились подключения.

## Жизненный цикл сеанса

- **Создание.** `sessionId` фиксирует пространство, и любой клиент или внешняя ссылка может объявить эту декларацию; сама ссылка не требует нажатия «Связать», а первый подключившийся ожидает второго в состоянии `waiting`, не получая дополнительных ролей или привилегий.
- **Существование.** После подключения второго участника `offer/answer` назначаются динамически в зависимости от порядка входа, оба участника разворачивают один и тот же контекст без деления на управляющих и принимающих, а сеанс считается активным после установления обоих WebSocket-клиентов.
- **Завершение.** Любой участник отправляет `hangup`, после чего сервер очищает очередь и `sessionId`, возвращая узел в нейтральную готовность нового цикла.

## Связь через ссылку

Ссылка остаётся декларацией доступа к активному сеансу: она указывает на существующее пространство, не назначает роли и может быть доставлена третьей стороной, позволяя обоим участникам войти по одной и той же ссылке независимо друг от друга.

## Поддержка автономности

Сервер хранит только состояние конкретного сеанса, поддерживает FIFO-очередь сообщений до подключения второго участника и очищает её после завершения; ограниченный технический след, отсутствие постоянных профилей и единый контекст взаимодействия сохраняют повторяемость узла на любом хосте.
