# Runtime сигналинга

Путь: `ctx/docs/composition/signal/runtime.md`

## Назначение

Фиксирует факт, что WebSocket `wss://<host>/signal` живёт вместе с `sessionId` и обслуживает два потока без дополнительных ролей.

## Поведение

- Соединение открывается при наличии `sessionId`: первый WebSocket-клиент остаётся в состоянии `waiting`, второй подключается после, и канал живёт до `ended` или `hangup`. Сеанс считается активным только после появления второго клиента, а интерфейс переключается из `waiting` в `active`.
- Сервер хранит до двух сокетов на `sessionId`, не различает роли и работает с FIFO-очередью сообщений, которую заполняет до подключения второго участника. Как только второй клиент подключается, очередь доставляется, и первый отправляет `offer`, второй — `answer`.
- Повторное подключение повторно использует тот же `sessionId`; клиент повторно подаёт последние состояния (`lastDescription`, `localCandidates`), DOM-элементы `remoteStream`/FAB остаются на месте, а сервер передаёт накопленные сообщения тому участнику, который только что вошёл.
- `error`-сообщения отображаются через `notifications`, `hangup` пересылается оставшемуся участнику, а после доставки сервер очищает очередь и `sessionId`.

## Связи

- `ctx/docs/composition/signal/messaging/message-formats/websocket.md` содержит набор полей, которые положены в основу runtime.
- `ctx/docs/composition/client/ui-states/states.md` описывает, какие UI-фрагменты соответствуют каждому состоянию, которое сопровождает WebSocket.
