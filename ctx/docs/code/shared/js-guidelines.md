# Соглашения JavaScript уровня code

Path: `./ctx/docs/code/shared/js-guidelines.md`

Эти правила определяют, как пишутся JavaScript-модули и инфраструктура во всех контурах, включая слабые места, где работает Codex. Они дополняют архитектуру (`ctx/docs/architecture/overview.md`) и продукт (`ctx/docs/product/overview.md`), но не переопределяют их.

## Язык и сообщения

- Комментарии, переменные, логгинг и сообщения об ошибках в коде — исключительно на английском. Строки, которые показываются пользователю (тосты, подсказки, описания полей) остаются на русском, как зафиксировано на product-уровне.
- Журналы предиктивны: в логах используется namespace (например, `[Flow]`, `[Signal]`, `[Peer]`), а формат и уровни консолируются через `HomeCall_Back_Logger`, `HomeCall_Web_Logger` и их фасады.
- Код не дублирует пользовательские сообщения: UI-тексты размещаются в `web/app/Ui` и `templates`, код передаёт только идентификаторы событий, а сами строки держатся в русском варианте.

## Логирование и диагностика

- Используйте инстансы логгеров из DI (`HomeCall_Back_Contract_Logger$`, `HomeCall_Web_Logger$`) и оборачивайте сообщения префиксами (`[Signal]`, `[Media]`) для фильтрации.
- Не раскрывайте персональные данные или sessionId в логах: передавайте только маркеры (`sessionId`, `role`, `tracks`) без имен/ссылок и не сохраняйте чувствительную информацию в cache или files.
- Ошибки сериализуются через `logger.exception(namespace, error)`; ручные `console.error` остаются только в helper-ах или guard-блоках, и тоже выводят структуру `{ namespace, message, details }`.

## Хранилища и приватность

- Хранение данных через `HomeCall_Web_Infra_Storage$` или `localStorage` ограничивается метаданными (`lastCheckedVersion`, `featureFlags`, `pendingVersionUpdate`, `preferredUiFlow`, `remoteLogging`, `autoToastSuppression`). Ни `sessionId`, ни пригласительные ссылки, ни имена в постоянное хранилище не пишутся. За пределы метаданных ответственность несёт `ctx/docs/constraints/storage.md`.
- Код не хранит личные данные: никакие модули не прописывают `name`, `profile`, `link` в долговременный state. Все идентификаторы живут в оперативной памяти и сбрасываются при остановке или очистке кеша.
- Очистка PWA-метаданных происходит через `HomeCall_Web_Pwa_Cache$`/`ServiceWorker`, которые вызываются из `web/app/Pwa` и логируют результат на английском.

## Общие установки

- `web/app/Ui` и `web/app/Net` используют `HomeCall_Web_Env_Provider$` для безопасного доступа к `window`, `navigator`, `fetch` и `WebSocket`; модули проверяют наличие API и не обращаются к DOM вне root-контейнера.
- Все классические `Codex`-агенты должны опираться на эти нормы: `ctx/docs/code` — технологическая опора для генерации модулей, управление кодом и проверка `npm run lint`/`npm run test:*`.
