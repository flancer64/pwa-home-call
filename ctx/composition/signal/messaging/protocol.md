# Протокол сигналинга для сеанса

Путь: `ctx/composition/signal/messaging/protocol.md`

## Назначение

Документ описывает последовательность фактических сообщений `wss://<host>/signal`, которые обмениваются участники во время единого `sessionId`.

## Последовательность событий

1. **Генерация `sessionId`** — при нажатии «Связать» появляется `sessionId`, и клиент остаётся в состоянии `waiting` с появления `share-link`.
2. **Гость (`initiator`) входит по ссылке** — при загрузке `invite`-режима по `?session=<uuid>` клиент подключается к `signal` и отправляет `offer`.
3. **Ответ принимающего (`recipient`)** — когда приемник получает `offer`, он отправляет `answer`, и браузер остаётся на `call`-макете.
4. **ICE-поток** — `candidate`-сообщения могут идти во время `active`, и каждый из участников доставляет их через тот же `sessionId`.
5. **Завершение** — по завершению вызова (`hangup`) сообщается инициатор, а `call`-макет переключается на `ended`.
6. **Ошибки/отказы** — `error` рассылаются заранее, чтобы UI мог отобразить сообщение через `ctx/composition/client/ui-elements/notifications.md`.

## Примечания

- Все сообщения содержат `sessionId`, что делает маршрутизацию тривиальной и позволяет клиенту не создавать новых экранов при смене состояний.
- Сообщения `offer/answer/candidate` не переносят UI-логику — клиент просто отображает `call`-макет и тосты, описанные в `ctx/composition/client/ui-states/states.md`.
