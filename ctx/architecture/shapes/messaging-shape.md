# Архитектурная форма сигнального обмена

Path: `./ctx/architecture/shapes/messaging-shape.md`

## Назначение

Фиксировать закрытый перечень архитектурных событий и инвариантов, которые пересекают сигналинг, соединяя клиентские и серверные контуры без упоминания JSON, SDP, WebSocket или процедурных деталей.

## Архитектурные события

- **Предложение соединения** — декларация желания начать `sessionId`, содержит минимальные архитектурные требования к готовности участников.
- **Ответ** — подтверждение второго участника и закрепление симметрии; оно фиксирует, что оба клиента согласились на один контекст.
- **Кандидат** — обозначает появление дополнительной транспортной опции, но остаётся архитектурной меткой о готовности, не раскрывая ICE/SDP.
- **Завершение** — фиксирует, что обмен переброшен в фазу окончания и накапливает обязательство очистить контекст.
- **Ошибка** — свидетельствует о нарушении инвариантов (например, несовпадение `sessionId` или потеря симметрии) и не декларирует процедуру восстановления.

Каждое событие привязано к одному `sessionId`, не вводит новые роли и не изменяет список допустимых фаз.

## Границы и маршрутизация

Сигнальный контур маршрутизирует события между клиентами и сервером, не храня очередей и не раскрывая способы доставки: события либо пересекли границу, либо нет. Клиент может исходно объявить `предложение`, сервер подтверждает `ответ`, а `кандидат` дополняет состояние готовности, оставаясь в пределах архитектурной формы.

## Инварианты

- Все события идентифицируются одним `sessionId`.
- Маршрутизация сохраняет симметрию: никакой участник не получает преференций по смыслам ролей.
- Сигнальный контур не раскрывает транспортную структуру и опирается на `ctx/constraints/session.md` для поддержания порядка.
