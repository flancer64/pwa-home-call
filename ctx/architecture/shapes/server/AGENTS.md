# Архитектурная форма серверного узла

Path: `./ctx/architecture/shapes/server/AGENTS.md`

## Назначение

Фиксировать форму серверного узла, его контуры, архитектурные данные и инварианты, обеспечивая симметрию участников и устойчивость `sessionId` без описания реализации.

## Контуры

- **Хранитель сеанса** удерживает `sessionId` на протяжении жизненного цикла, связывает события с контекстом и очищает его после завершения, соблюдая stateless-инвариант из `ctx/constraints/node.md`.
- **Сигнальный маршрутизатор** сопоставляет входящие архитектурные события с `sessionId`, обеспечивает симметричную маршрутизацию между двумя участниками и проверку последовательности без ролей.
- **Контур окружения** фиксирует платформенные параметры (`TLS`, proxy, systemd) как декларации контракта исполнения, не делая шагов по их настройке.
- **Наблюдаемость** записывает архитектурные события и переходы как декларации, не вмешиваясь в бизнес-логику или повторную доставку.

## Архитектурные данные и ответственность

- `sessionId` остаётся единственным якорем, связывающим события сервера, маршрутизатора и окружения.
- Сервер хранит минимальную информацию и не поддерживает очереди или длительные stateful-хранилища, чтобы сохранить симметрию и изоляцию контекстов.
- Маршрутизатор оперирует архитектурными событиями (`предложение`, `ответ`, `кандидат`, `завершение`, `ошибка`), не раскрывая их внутреннюю структуру и сохраняя декларативную природу.

## Инварианты

- Каждый `sessionId` очищается на переходе из `ended` и не возвращается до объявления нового идентификатора.
- Сервер обеспечивает симметрию двух участников: события одного `sessionId` обрабатываются одинаково с обеих сторон.
- Контур окружения остаётся декларативным и сохраняет границу между архитектурной формой и эксплуатационной средой.

## Карта уровня

- `AGENTS.md` — индекс серверного пространства с описанием контуров, данных и инвариантов.
