# Архитектурная форма клиентского узла

Path: `./ctx/architecture/shapes/client-shape.md`

## Назначение

Фиксировать форму клиентского контурa: какие архитектурные ответственности несёт пользовательский узел, какие данные он принимает и объявляет, какие состояния фиксирует, и какие инварианты он поддерживает при взаимодействии с другими контурами.

## Контурные обязанности

- **Контекст сеанса** удерживает `sessionId`, декларирует share-link и фиксирует текущее архитектурное состояние (`ready`, `waiting`, `active`, `ended`) без описания UI или локальных API.
- **Презентационный контур** отражает состояния, помогая участнику определить готовность к обмену, но не управляет транспортом, DI или WebRTC-обёртками.
- **Транспортный интерфейс** переводит архитектурные события в сигнальный контур, сохраняя симметричность `sessionId` и не вводя роли инициатора/приёмника.
- **Медиа-интерфейс** фиксирует доступность устройств и потоков как архитектурные флаги о готовности, без сведения о SDP, ICE или DOM.
- **Окружение** поставляет параметры из `ctx/environment/overview.md` и поддерживает нейтральность к TLS, systemd и инфраструктурным деталям.

## Архитектурные данные и события

- `sessionId` остаётся единственным идентификатором контекста и распространяется по всем частям контура без раскрытия формата.
- Ссылка активирует `sessionId` и сообщает остальным контурам о новой декларации.
- Клиент объявляет архитектурные события (`предложение`, `ответ`, `кандидат`, `завершение`, `ошибка`), каждое из которых связано с одним `sessionId` и с одной фазой жизни контекста.

## Состояния и инварианты

- Состояния клиента повторяют фазовую модель (`ready`, `waiting`, `active`, `ended`) и отражают, когда доступен `sessionId`, когда идёт согласование и когда обмен завершён.
- Клиент никогда не хранит скрытые состояния вне этих деклараций и не расширяет количество участников сверх двух, следуя `ctx/product/overview.md`.
- Все события клиента пересекают границу сигнального контура, сохраняя симметричность и упорядоченность.
