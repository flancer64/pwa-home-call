# Архитектурная форма серверного узла

Path: `./ctx/architecture/shapes/server-shape.md`

## Назначение

Фиксировать архитектурную форму серверного узла: какие контуры внутри сервера существуют, какие данные они поддерживают и какие инварианты обеспечивают при удержании `sessionId` и симметрии двух участников.

## Контуры сервера

- **Хранитель сеанса** — удерживает единственный `sessionId` на протяжении жизненного цикла, связывает события с контекстом, очищает его после фазы завершения и поддерживает stateless-инвариант из `ctx/constraints/node.md`.
- **Сигнальный маршрутизатор** — сопоставляет приходящие архитектурные события с `sessionId`, гарантирует симметричную маршрутизацию между двумя участниками и выполняет проверку последовательности без введения ролей инициатора/приёмника.
- **Контур окружения** — фиксирует платформенные параметры (`TLS`, proxy, systemd) из `ctx/environment/overview.md`, но не описывает их настройку; он выступает контрактом для поддержания стабильных условий исполнения.
- **Наблюдаемость** — записывает архитектурные события и переходы как декларации, не вмешиваясь в бизнес-логику или повторную доставку.

## Архитектурные данные и ответственность

- `sessionId` остаётся единственным якорем, который связывает события сервера, сигнального маршрутизатора и окружения.
- Сервер удерживает только минимальную информацию: ему не нужны очереди или длительные stateful-хранилища, чтобы подтверждать симметрию и изоляцию контекстов.
- Маршрутизатор оперирует архитектурными событиями (`предложение`, `ответ`, `кандидат`, `завершение`, `ошибка`), не раскрывая их внутреннюю структуру.

## Инварианты

- Каждый `sessionId` очищается на переходе из фазы завершения, и затем не возвращается до объявления нового идентификатора.
- Сервер поддерживает симметрию двух участников: все события одного `sessionId` обрабатываются одинаково с обеих сторон.
- Контур окружения остаётся декларативным и не вмешивается в сигнальные события, соблюдая границу между архитектурной формой и эксплуатационной средой.
