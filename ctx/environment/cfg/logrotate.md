# Конфигурация logrotate для Node.js-приложения Связист (`ctx/rules/arch/env/logrotate.md`)

## Назначение

Определяет правила ротации логов backend-приложения Связист, запускаемого через systemd.  
Документ фиксирует стандартную схему логирования с автоматическим архивированием и очисткой старых файлов.

> Ограничения на логирование и технические метки `sessionId` теперь описаны в `ctx/constraints/conventions.md` и `ctx/constraints/node.md`; logrotate занимается их безопасным хранением.

---

## Пример конфигурации logrotate

Файл `/etc/logrotate.d/svyazist` содержит:

```conf
/home/{user}/store/app/svyazist/log/out.log {
    daily
    rotate 14
    compress
    delaycompress
    missingok
    notifempty
    copytruncate
}
```

---

## Правила настройки

1. Конфигурационный файл сохраняется под именем `/etc/logrotate.d/svyazist`.
2. Путь `/home/{user}/store/app/svyazist/log/out.log` должен совпадать с настройкой в `systemd`-сервисе.
3. Права на каталог логов должны позволять пользователю `{user}` запись и чтение.
4. Ротация выполняется ежедневно:

   - создаются архивы `out.log.1.gz`, `out.log.2.gz`, …;
   - хранятся 14 последних копий;
   - пустые или отсутствующие файлы игнорируются (`missingok`, `notifempty`);
   - используется безопасный режим `copytruncate` для корректного обновления активного файла без перезапуска сервиса.

5. Для ручного запуска ротации:

```bash
sudo logrotate -f /etc/logrotate.d/svyazist
```

---

## Связи

- `./systemd.md` — управление запуском приложения и формирование логов.
- `../back.md` — архитектура backend-приложения.
- `./node.md` — окружение Node.js.

---

## Итог

Документ фиксирует правила ротации логов Связист.
Конфигурация logrotate обеспечивает ежедневное сжатие, хранение последних 14 архивов и безопасное обновление активного файла без остановки сервиса.
