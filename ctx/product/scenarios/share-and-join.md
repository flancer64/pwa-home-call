# Сценарий: Совместное подключение через ссылку

## Назначение

Описывает сценарий быстрого соединения между двумя пользователями ДомоЗвона без ручного ввода кодов. Один пользователь формирует и отправляет ссылку, второй — открывает её и автоматически подключается к нужной комнате под заданным именем.

## Участники

- **Отправитель приглашения** — пользователь, создающий ссылку и передающий её собеседнику.
- **Получатель приглашения** — пользователь, открывающий полученную ссылку.

## Предварительные условия

- Оба пользователя имеют устройство с браузером, поддерживающим WebRTC и Web Share API (для мобильных устройств).
- Приложение ДомоЗвон доступно по публичному URL.
- У отправителя настроены имя и комната, сохранённые локально в браузере.

## Основной сценарий

1. Отправитель открывает ДомоЗвон и задаёт:
   - имя, под которым он будет виден собеседнику;
   - кодовое слово (имя комнаты).
2. Приложение предлагает сгенерировать ссылку для приглашения.
3. Ссылка содержит параметры `room` и `name`, например:

```md
[https://domozvon.app/?room=dukat&name=alex](https://domozvon.app/?room=dukat&name=alex)
```

4. Отправитель передаёт ссылку собеседнику:

- через Web Share API (на мобильных устройствах),
- или любым другим способом (мессенджер, e-mail и т.п.).

5. Получатель открывает ссылку:

- если ДомоЗвон не установлен, он устанавливается как PWA;
- после загрузки приложение автоматически:
  - перенаправляет поток на экран `invite`, где пользователь видит параметры `room`/`name`, согласует их и/или редактирует перед подключением;
  - сохраняет переданные параметры (`room`, `name`) локально и подключается к соответствующей комнате через `HomeCall_Web_Net_SignalClient`.

6. В результате оба участника оказываются в одной комнате под заданными именами и могут начать видеозвонок.

## Альтернативные сценарии

- **A1.** Получатель изменяет имя перед подключением — приложение сохраняет новое имя локально.
- **A2.** Приложение не имеет доступа к Web Share API — ссылка копируется вручную.
- **A3.** При повторном открытии ДомоЗвон использует последние сохранённые значения `room` и `name`.

## Постусловия

- Имя пользователя и последняя использованная комната сохранены в `localStorage`.
- Приложение готово к повторным подключениям без ввода данных.
- Отправитель может переиспользовать тот же URL для повторного вызова.

## Экран приглашения (invite)

- `invite` разграничивает стадии создания и принятия ссылки: инициатор проверяет локальные `room`/`name`, кликая «Поделиться ссылкой» и используя Web Share API или копирование; получатель подтверждает данные из ссылки и только затем подключается.
- Взаимодействие с `invite` описано в `ctx/rules/web/ui/screens/invite.md` и в `ctx/product/features/share.md`, где описаны уведомления и события (`ui:action:share-link`).

## Связь с другими документами

- **features.md** — описывает наличие функции на уровне продукта.
- **features/share.md** — детализация функции совместного подключения и роли экрана `invite` в подтверждении комбинации `room/name`.
- **rules/web/ui/screens/invite.md** — спецификация нового состояния, которое активируется при получении ссылки.
