# Поток высокоуровневой связи

Path: `./ctx/product/flows/connection.md`

## Идея

Поток показывает, как инициатор и получатель остаются в одной вкладке связи: от запуска сеанса до завершения, включая передачу ссылки и установление медиа-потока. Он служит картой состояний, а не руководством по кнопкам, и опирается на `overview.md` для контекста и на `capabilities/*` для деталей.

## Участники

- **Инициатор** — тот, кто открывает приложение, запускает сессию и может поделиться ссылкой внутри неё.
- **Получатель** — тот, кто получает приглашение и автоматически попадает в уже существующий сеанс.

## Высокоуровневые этапы

Сначала инициатор запускает WebRTC-сеанс в текущем окне, и интерфейс фиксирует локальное превью с визуальными сигналами состояния. Во время ожидания внутри того же представления появляется возможность создать ссылку и передать её через доступные каналы. Получатель использует ссылку, браузер считывает параметр `session`, и соединение переходит в активную передачу, при этом интерфейс остаётся в одном пространстве. Завершение происходит без переходов — кнопка выхода или закрытие вкладки прекращают сеанс, и ссылка деактивируется.

## Альтернативные ветви

- Если Shared API недоступен, ссылка остаётся доступной для копирования внутри окна и отправки вручную, не вводя дополнительных экранов.
- Если подключение задерживается, интерфейс сохраняет состояние ожидания и даёт возможность инициатору повторно отправить ссылку без смены контекста.

## Постусловия

- Сеанс уничтожается при закрытии окна или выходе; ссылка больше не действует.
- Инициатор и получатель завершили разговор внутри одного пространства, без перехода к двум экранам или формам.
