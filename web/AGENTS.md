# Инструкции для агента уровня `web/`

## Назначение

Документ определяет единственное принципиальное правило работы агента при внесении изменений в браузерное приложение Связист (`./web/`).

## Карта уровня

- `app/` — исходные модули, логика и API браузерного приложения для клиентского слоя.
- `assets/` — статические ресурсы (иконки, шрифты, изображения), используемые в интерфейсе.
- `ui/` — вспомогательные композиции для экранов, разбитые по состояниям и уведомлениям.
- `AGENTS.md` — текущий файл, описывающий правила обновления и версионирования `web/`.
- `app.js` — точка входа браузерного клиента, конфигурирующая модули и сервисы.
- `index.html` — основная обёртка PWA и точка загрузки для всего интерфейса.
- `manifest.json` — описание PWA-манифеста с метаданными и разрешениями.
- `service-worker.js` — сервисный работник, управляющий кэшированием и обновлениями.
- `version.json` — файл, фиксирующий версию сборки и использующийся процессом обновления.

---

## Правило обновления версии

Всякое изменение файлов в каталоге `./web/` (HTML, JS, CSS, assets, модули, манифесты и т.п.) должно сопровождаться обновлением `web/version.json`. Это гарантирует, что механизм PWA-обновления (см. `ctx/rules/web/pwa.md`) получает новый `svyazist-v{version}` и пользователи автоматически получают актуальную сборку.

### Требуемое состояние

- `web/version.json` содержит единственное поле:

```json
{ "version": "YYYYMMDD-HHMMSS" }
```

- `version` — актуальный UTC-timestamp (см. шаги ниже).
- Файл сохраняется в том же коммите, что и изменения из `./web/`.
- Строка с этим значением упоминается в отчёте итерации `ctx/agent/report/...` (если отчёт ещё не существует, создайте его с описанием версии).

### Процедура

1. Перед завершением итерации, если вы меняли файлы внутри `./web/`, обязательно выполните `date -u +%Y%m%d-%H%M%S` и вставьте результат в `web/version.json`.
   - Принудительно проверьте `git status` перед завершением, чтобы убедиться, что `web/version.json` входит в список изменений (в противном случае это явный признак нарушения).
2. Убедитесь, что файл закоммичен вместе с остальными изменениями веб-слоя и не содержит других полей.
3. Запишите версию в отчёте итерации (например, «Обновлено `web/version.json` → `20251110-210017`»), чтобы фиксация была прозрачной.

---

## Исключения

Обновление версии не требуется, если вы меняете только когнитивный слой (`ctx/`), backend-код (`src/`), тесты `test/unit/`) или иные файлы вне `./web/`.

---

## Итог

Агент теперь не только знает правило, но и знает, как его выполнить: обновление UTC-тimestamp в `web/version.json` — обязательный элемент любой веб-правки. Отчётность служит подтверждением того, что версия была поднята параллельно с изменением интерфейса.
